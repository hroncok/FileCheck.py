import os

import lit.formats


def is_windows():
    return os.name == 'nt'


config.name = "FileCheck.py integration tests"
config.test_format = lit.formats.ShTest("0")

current_dir = os.getcwd()

# LLVM LIT: Is it possible to pass user defined parameter into a test script?
# https://stackoverflow.com/a/39861848/598057
filecheck_exec = lit_config.params['FILECHECK_EXEC']
assert(filecheck_exec)

filecheck_tester_exec = lit_config.params['FILECHECK_TESTER_EXEC']
assert(filecheck_tester_exec)

real_only = lit_config.params['REAL_ONLY']

config.substitutions.append(('%FILECHECK_EXEC', filecheck_exec))
config.substitutions.append(('%FILECHECK_TESTER_EXEC', filecheck_tester_exec))

cat_exec = "cat" if not is_windows() else "type"
config.substitutions.append(('%cat', cat_exec))

config.substitutions.append(('%expect_exit', 'python \"{}/tests/integration/tools/expect_exit.py\"'.format(current_dir)))

config.suffixes = ['.itest', '.c']

config.is_windows = is_windows()
config.is_llvm_filecheck_test = real_only

